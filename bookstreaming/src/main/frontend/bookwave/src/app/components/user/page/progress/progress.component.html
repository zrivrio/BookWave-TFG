<div class="container mx-auto p-4">
  <!-- Estado no autenticado -->
  <div *ngIf="!isLoggedIn" class="flex flex-col items-center justify-center min-h-[60vh] text-center">
    <div class="bg-white p-8 rounded-xl shadow-sm border border-[#E0E9F5] max-w-lg w-full">
      <h2 class="text-2xl font-bold text-[#2A2A2A] mb-4">Seguimiento de lectura</h2>
      <p class="text-[#666666] mb-6">Inicia sesión para hacer un seguimiento de tu progreso de lectura</p>
      <a routerLink="/login" 
         class="inline-block px-6 py-3 bg-[#1C1DAB] hover:bg-[#1E0F75] text-white rounded-lg font-medium transition-colors">
        Iniciar Sesión
      </a>
    </div>
  </div>

  <!-- Contenido para usuarios autenticados -->
  <div *ngIf="isLoggedIn">
    <h2 class="text-2xl font-bold mb-4">Mis libros en progreso</h2>

    <!-- Estados de carga y error -->
    <div *ngIf="isLoading" class="flex justify-center py-8">
      <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-blue-500"></div>
    </div>

    <div *ngIf="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      {{ error }}
    </div>

    <div *ngIf="!isLoading && books.length === 0" class="text-center py-8">
      <p>No tienes libros en progreso</p>
    </div>

    <!-- Grid de libros -->
    <div *ngIf="!isLoading && books.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div *ngFor="let book of books" class="border rounded-lg p-4 shadow hover:shadow-md transition-shadow">
        <div class="flex items-start space-x-4">
          <!-- Portada del libro -->
          <a [routerLink]="['/book', book.id]" class="block">
            <img [src]="book.cover || 'assets/images/default-book-cover.jpg'" 
                 [alt]="book.title" 
                 class="w-24 h-36 object-cover rounded hover:opacity-80 transition-opacity"
                 onerror="this.src='assets/images/default-book-cover.jpg'">
          </a>
          
          <!-- Detalles del libro -->
          <div class="flex-1">
            <a [routerLink]="['/book', book.id]" class="block group">
              <h3 class="font-semibold group-hover:text-blue-600 transition-colors">{{ book.title }}</h3>
              <p class="text-gray-600">{{ book.author }}</p>
            </a>
            
            <!-- Barra de progreso -->
            <div class="mt-2">
              <div class="flex items-center justify-between mb-2">
                <span>Progreso: {{ getProgressPercentage(book) }}% ({{ currentPages[book.id] || 0 }}/{{ book.totalPages || 0 }} páginas)</span>
                <button 
                  (click)="toggleEditMode(book.id)" 
                  class="text-blue-500 hover:text-blue-700 transition-colors">
                  {{ editingProgress[book.id] ? 'Guardar' : 'Editar' }}
                </button>
              </div>

              <div *ngIf="!editingProgress[book.id]" class="w-full bg-gray-200 rounded-full h-2.5">
                <div class="h-2.5 rounded-full transition-all duration-300" 
                     [ngClass]="getProgressColor(getProgressPercentage(book))"
                     [style.width.%]="getProgressPercentage(book)">
                </div>
            </div>
            
            <div *ngIf="editingProgress[book.id]" class="space-y-2">
                <div class="flex items-center">
                    <input 
                        type="number" 
                        [(ngModel)]="currentPages[book.id]"
                        (keyup.enter)="updateProgress(book)"
                        (blur)="updateProgress(book)"
                        class="w-24 border rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        [min]="0" 
                        [max]="book.totalPages || 0"
                        placeholder="Páginas leídas">
                    <span class="ml-2 text-sm text-gray-600">
                        / {{ book.totalPages || 0 }} páginas
                    </span>
                </div>
                <div class="text-sm text-blue-600">
                    Progreso: {{ calculatePercentage(currentPages[book.id] || 0, book.totalPages || 0) }}%
                </div>
            </div>

            <!-- Acciones -->
            <div class="mt-4 flex justify-between">
              <a [routerLink]="['/read', book.id]" 
                 class="text-blue-500 hover:text-blue-700 transition-colors">
                Continuar leyendo
              </a>
              <button (click)="deleteProgress(book)" 
                      class="text-red-500 hover:text-red-700 transition-colors">
                Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
