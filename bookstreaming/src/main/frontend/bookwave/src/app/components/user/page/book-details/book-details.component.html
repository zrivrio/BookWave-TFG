<div class="max-w-7xl mx-auto px-6 py-8" *ngIf="!loading">
    <div *ngIf="book; else noBook" class="space-y-10">
  
      <!-- 游댳 Parte superior m치s compacta -->
      <div class="bg-white rounded-xl shadow-md p-6 border border-[#E0E9F5]">
        <div class="flex flex-col md:flex-row gap-6">
          <!-- Portada reducida -->
          <div class="w-full md:w-1/5">
            <img 
              [src]="book.cover || 'assets/images/default-book-cover.jpg'" 
              [alt]="book.title" 
              class="w-full h-auto object-cover aspect-[2/3]"
              onerror="this.src='assets/images/default-book-cover.jpg'">
          </div>
  
          <!-- Detalles m치s peque침os -->
          <div class="w-full md:w-4/5 space-y-3">
            <div>
              <h1 class="text-2xl font-semibold text-[#2A2A2A]">{{ book.title }}</h1>
              <h2 class="text-lg text-[#666666] mt-1">por {{ book.author || 'Autor desconocido' }}</h2>
            </div>
  
            <div class="flex flex-wrap gap-2 items-center text-sm">
              <span class="px-3 py-1 rounded-full bg-[#E6F0F7] text-[#1C1DAB] font-medium">
                {{ book.language || 'Idioma no especificado' }}
              </span>
              <span class="px-3 py-1 rounded-full bg-[#F4F4F4] text-[#666666] font-medium">
                {{ book.year || 'A침o desconocido' }}
              </span>
              <span *ngIf="book.averageRating" class="px-3 py-1 rounded-full bg-[#FFC107] text-[#2A2A2A] font-medium flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                  <path d="..." />
                </svg>
                {{ book.averageRating | number:'1.1-1' }}
              </span>
            </div>
  
            <div>
              <h3 class="text-md font-semibold text-[#1C1DAB] mb-1">Descripci칩n</h3>
              <p class="text-sm text-[#666666] leading-relaxed">
                {{ book.description || 'No hay descripci칩n disponible para este libro.' }}
              </p>
            </div>
  
            <div class="pt-2">
              <button 
                (click)="onReadNow()"
                [disabled]="!currentUser"
                class="px-5 py-2 bg-[#1C1DAB] hover:bg-[#1E0F75] text-white rounded-lg shadow-sm transition disabled:opacity-50 text-sm"
                [title]="!currentUser ? 'Debes iniciar sesi칩n para leer' : 'Comenzar a leer'">
                Leer ahora
              </button>
              <app-add-to-reading-list [bookId]="book.id"></app-add-to-reading-list>
            </div>
          </div>
        </div>
      </div>
  
      <!-- 游댲 Parte inferior m치s amplia -->
      <div class="flex flex-col lg:flex-row gap-8 min-h-[500px]">
        
        <!-- Formulario (m치s estrecho) -->
        <div class="w-full lg:w-1/4">
          <app-review-form 
            *ngIf="currentUser"
            [bookId]="book.id" 
            [bookTitle]="book.title"
            [currentUser]="currentUser"
            (reviewSubmitted)="reviewList.refreshReviews($event)">
          </app-review-form>
        </div>
  
        <!-- Rese침as (m치s alto y ancho con scroll) -->
        <div class="w-full lg:w-3/4 max-h-[600px] overflow-y-auto border border-[#E0E9F5] rounded-lg p-4 bg-white">
          <app-review-list 
            #reviewList
            [bookId]="book.id">
          </app-review-list>
        </div>
      </div>
    </div>
  
    <!-- Loading y errores -->
    <ng-template #noBook>
      <div *ngIf="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg">
        {{ error }}
      </div>
      <div *ngIf="!error" class="bg-blue-100 border border-blue-300 text-blue-800 px-4 py-3 rounded-lg">
        Libro no encontrado
      </div>
    </ng-template>
  </div>
  
  <div *ngIf="loading" class="flex flex-col items-center justify-center min-h-[300px]">
    <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-[#1C1DAB] border-opacity-50 mb-4"></div>
    <p class="text-[#666666]">Cargando detalles del libro...</p>
  </div>
  